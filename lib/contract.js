var web3 = require('./web3.js');
var connection = require('./SQL.js');

var annuityContract = web3.eth.contract([{"constant":true,"inputs":[],"name":"getPayTime","outputs":[{"name":"","type":"uint256[3]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getCompanyAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getStatus","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"version","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"destroy","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"endAnnuity","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getNowTime","outputs":[{"name":"","type":"uint256[3]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getDeployTime","outputs":[{"name":"","type":"uint256[3]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getInsurerAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"revoke","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"confirme","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getRevocationPeriod","outputs":[{"name":"","type":"uint256[3]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"year","type":"uint256"},{"name":"month","type":"uint256"},{"name":"day","type":"uint256"}],"name":"time","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"finishPayment","outputs":[],"payable":false,"type":"function"},{"inputs":[{"name":"y","type":"uint256"},{"name":"m","type":"uint256"},{"name":"d","type":"uint256"}],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[],"name":"PayEvent","type":"event"},{"anonymous":false,"inputs":[],"name":"RevocationEvent","type":"event"},{"anonymous":false,"inputs":[],"name":"RevocationMailEvent","type":"event"},{"anonymous":false,"inputs":[],"name":"NotRevocationEvent","type":"event"}]);
class Contract {
    constructor() {
        
    }
    deploy() {
        this.annuity = annuityContract.new(
            new Date().getFullYear(), new Date().getMonth()+1, new Date().getDate(),
            {
                from: web3.eth.accounts[0],
                data: '60a0604052600560608190527f312e302e330000000000000000000000000000000000000000000000000000006080908152620000409160109190620002d7565b5034156200004a57fe5b60405160608062000eb58339810160409081528151602083015191909201515b60008054600160a060020a033316600160a060020a03199182161782556001805490911673e2320c12c71fb4a91d756d21507b33ee05f2f4c71781556103e860039081556017919091556011919091556040805160608101825285815260208101859052908101839052620000e391600491906200035d565b5060408051606081018252848152602081018490529081018290526200010e9060079060036200035d565b5060408051606081018252601485018152602081018490529081018290526200013c90600d9060036200035d565b5060408051808201909152600b81527f756e636f6e6669726d65640000000000000000000000000000000000000000006020820152601260005b0160005b5081516200018c9260200190620002d7565b5060408051808201909152600c81527f63616e42655265766f6b656400000000000000000000000000000000000000006020820152601260015b0160005b508151620001dc9260200190620002d7565b5060408051808201909152600981527f636f6e6669726d656400000000000000000000000000000000000000000000006020820152601260025b0160005b5081516200022c9260200190620002d7565b506040805180820190915260038082527f656e64000000000000000000000000000000000000000000000000000000000060208301526012905b0160005b5081516200027c9260200190620002d7565b5060408051808201909152600a81527f5265766f636174696f6e000000000000000000000000000000000000000000006020820152601260045b0160005b508151620002cc9260200190620002d7565b505b505050620003c5565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200031a57805160ff19168380011785556200034a565b828001600101855582156200034a579182015b828111156200034a5782518255916020019190600101906200032d565b5b5062000359929150620003a1565b5090565b82600381019282156200034a579160200282015b828111156200034a5782518255916020019190600101906200032d565b5b5062000359929150620003a1565b5090565b620003c291905b80821115620003595760008155600101620003a8565b5090565b90565b610ae080620003d56000396000f300606060405236156100bf5763ffffffff60e060020a6000350416630d8e6e2c81146100c157806323cd7613146101515780633944615c1461019e5780634e69d560146101ca57806354fd4d50146100c157806383197ef0146102ea5780638ed301c1146102fc578063951093f9146103175780639b819d3814610329578063a275ee1b14610376578063b16270fc146103c3578063b6549f75146103ef578063e286364614610401578063e5fad55f1461044e578063e9931fbc14610469575bfe5b34156100c957fe5b6100d161047b565b604080516020808252835181830152835191928392908301918501908083838215610117575b80518252602083111561011757601f1990920191602091820191016100f7565b505050905090810190601f1680156101435780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561015957fe5b610161610514565b604051808260608083835b80518252602083111561018c57601f19909201916020918201910161016c565b50505090500191505060405180910390f35b34156101a657fe5b6101ae610551565b60408051600160a060020a039092168252519081900360200190f35b34156101d257fe5b6100d1610561565b604080516020808252835181830152835191928392908301918501908083838215610117575b80518252602083111561011757601f1990920191602091820191016100f7565b505050905090810190601f1680156101435780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156100c957fe5b6100d161047b565b604080516020808252835181830152835191928392908301918501908083838215610117575b80518252602083111561011757601f1990920191602091820191016100f7565b505050905090810190601f1680156101435780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156102f257fe5b6102fa6106a6565b005b341561030457fe5b6102fa6004356024356044356106ce565b005b341561031f57fe5b6102fa610739565b005b341561033157fe5b61016161075d565b604051808260608083835b80518252602083111561018c57601f19909201916020918201910161016c565b50505090500191505060405180910390f35b341561037e57fe5b61016161079a565b604051808260608083835b80518252602083111561018c57601f19909201916020918201910161016c565b50505090500191505060405180910390f35b34156103cb57fe5b6101ae6107d7565b60408051600160a060020a039092168252519081900360200190f35b34156103f757fe5b6102fa6107e7565b005b341561040957fe5b610161610851565b604051808260608083835b80518252602083111561018c57601f19909201916020918201910161016c565b50505090500191505060405180910390f35b341561045657fe5b6102fa60043560243560443561088e565b005b341561047157fe5b6102fa610a03565b005b610483610a1a565b6010805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156105095780601f106104de57610100808354040283529160200191610509565b820191906000526020600020905b8154815290600101906020018083116104ec57829003601f168201915b505050505090505b90565b61051c610a2c565b60408051606081019182905290600d9060039082845b815481526020019060010190808311610532575b505050505090505b90565b600054600160a060020a03165b90565b610569610a1a565b6011546012906005811061057957fe5b0160005b50805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156105095780601f106104de57610100808354040283529160200191610509565b820191906000526020600020905b8154815290600101906020018083116104ec57829003601f168201915b505050505090505b90565b610483610a1a565b6010805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156105095780601f106104de57610100808354040283529160200191610509565b820191906000526020600020905b8154815290600101906020018083116104ec57829003601f168201915b505050505090505b90565b60005433600160a060020a03908116911614156106cb57600054600160a060020a0316ff5b5b565b601154156106dc5760006000fd5b6001601155604080516060810182528481526020810184905290810182905261070990600a906003610a54565b506040517fee578fafe07eeabcdd18a1409e8daf0f64c95a2c3507a3ca99d30d4bf0263d3490600090a15b505050565b60005433600160a060020a039081169116146107555760006000fd5b60036011555b565b610765610a2c565b6040805160608101918290529060079060039082845b815481526020019060010190808311610532575b505050505090505b90565b6107a2610a2c565b6040805160608101918290529060049060039082845b815481526020019060010190808311610532575b505050505090505b90565b600154600160a060020a03165b90565b601154600114610820576040517f63ba734b2284e198028f5c4f5b1f13ec01a68754b572e13ed46e260c04b54fb290600090a160006000fd5b60046011556040517f6cef9787f18c5faa139827fe7c624f937d4432805a3667326ee810715a2fbe8d90600090a15b565b610859610a2c565b60408051606081019182905290600a9060039082845b815481526020019060010190808311610532575b505050505090505b90565b60408051606081018252848152602081018490529081018290526108b6906007906003610a54565b506011546001141561094757600a60005b0160005b50548311806108f75750600a60005b0160005b5054831480156108f75750600a60015b0160005b505482115b5b806109365750600a60005b0160005b5054831480156109205750600a60015b0160005b505482145b80156109365750600a60025b0160005b50548110155b5b156109425760026011555b610734565b6011546002141561073457600d60005b0160005b50548311806109875750600d60005b0160005b5054831480156109875750600d60015b0160005b505482115b5b806109c65750600d60005b0160005b5054831480156109b05750600d60015b0160005b505482145b80156109c65750600d60025b0160005b50548110155b5b156107345760026011556040517fb92b9f3b7da75c4d29af62e228d6a8212c2414d2d0d8f2e9062cf03d4c717b2690600090a15b5b5b5b505050565b601754600d60005b0160005b50805490910190555b565b60408051602081019091526000815290565b6060604051908101604052806003905b6000815260200190600190039081610a3c5790505090565b8260038101928215610a82579160200282015b82811115610a82578251825591602001919060010190610a67565b5b50610a8f929150610a93565b5090565b61051191905b80821115610a8f5760008155600101610a99565b5090565b905600a165627a7a723058207a60320df84de2e990916b1f5a8ff3f69be3d6dc098360a1267c71199e2253c00029',
                gas: '4700000'
            }, function (e, contract) {
                console.log(e, contract);
                if (typeof contract.address !== 'undefined') {
                    console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                    //將contract加入mySQL
                    /*
                    connection.connect();
                    connection.query('INSERT INTO smart.contract (ID, address) VALUES (\'nidhogg5\', \'' + contract.address + '\');', function (error) {
                        if (error) {
                            console.log('寫入資料失敗！');
                            throw error;
                        }
                    });
                    connection.end();
                    */
                }
            })
    }
}

module.exports = Contract