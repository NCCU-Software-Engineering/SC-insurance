{{#section 'css'}}
<link rel="stylesheet" href="css/template.css"> {{/section}}

<section id>
    <div class="container">
        <div class="row">
            <h1 class="text-center">年金樣板</h1>
        </div>
    </div>
</section>

<section id="template">
    <div class="container">
        <div class="row">

            <!--左視窗-->
            <div class="col-md-6">
                <div class="panel panel-success" id="parameter">
                    <!--heading-->
                    <div class="panel-heading">
                        傳統合約
                        <a>下載PDF</a>
                    </div>
                    <!--body-->
                    <div class="panel-body" id="traditional-contract" style="border-width: 2">

                        <div id="t1" onmouseover="mouseOver(1)" onmouseout="mouseOut(1)">
                            <h2>
                                【保險契約的構成】<br>第一條
                            </h2>
                            <p>
                                本保險單條款、附著之要保書、批註及其他約定書，均為本保險契約（以下簡稱本契約）的構成部分。 本契約的解釋，應探求契約當事人
                                <font color="red">[ {{user_name}} ]</font>的真意不得拘泥於所用文字；如有疑義時以作利被 本契約的解釋，應探求當事人
                                <font color="red">[ {{user_name}} ]</font>真意不得拘泥於所用文字；如有疑義時以作利於被保險人的解釋為原則。
                            </p>
                        </div>

                        <h2>
                            【名詞定義】<br>第二條
                        </h2>
                        本契約所稱名詞定義如下：
                        <div id="t2" onmouseover="mouseOver(2)" onmouseout="mouseOut(2)">
                            <bt> 一、本契約所稱「保證期間」係指依本契約約定，不論被保險人生存與否，本公司保證給付年金之期間。要保人於投保時在要保書上選擇十年、二十年或三十年
                                <font color="red">[ {{time}}年 ]</font>為保證期間。
                        </div>
                        <br> 二、本契約所稱「年金金額」係指依本契約約定之條件及期間，本公司分期給付之金額
                        <font color="red">[ {{money}}萬元 ]</font>。
                        <br> 三、本契約所稱「未支領之年金餘額」係指被保險人於本契約年金保證期間內尚未領取之年金金額。
                        <br> 四、本契約所稱「保險年齡」係指按投保時被保險人之足歲計算，但未滿一歲的零數超過六個月者加算一歲，以後每經過一個保險單年度加算一歲，且同一保險單年度內保險年齡不變。 五、本契約所稱「預定利率」係指本公司於年金給付開始日用以計算年金金額之利率，本契約之預定利率為年利率百分之二點三。
                        <p>
                        </p>

                        <h2>
                            【保險公司應負責任的開始】<br>第三條
                        </h2>
                        <p>
                            本公司應自同意承保且收取躉繳保險費後負保險責任，並應發給保險單作為承保的憑證。 本公司如於同意承保前，預收相當於躉繳保險費之金額時，其應負之保險責任，以同意承保時溯自預收相當於躉繳保險費金額時開始。但本公司同意承保前而被保險人身故時，本公司無息退還要保人躉繳保險費。<br>                            本公司自預收相當於躉繳保險費之金額後十五日內不為同意承保與否之意思表示者，視為同意承保。
                        </p>
                        <div id="t3" onmouseover="mouseOver(3)" onmouseout="mouseOut(3)">
                            <h2>
                                【契約撤銷權】<br>第四條
                            </h2>
                            <p>
                                要保人於保險單送達的翌日起算十日內，得以書面或其他約定方式檢同保險單向本公司撤銷本契約。 要保人依前項規定行使本契約撤銷權者，撤銷的效力應自要保人書面或其他約定方式之意思表示到達翌日零時起生效，本契約自始無效，本公司應無息退還要保人躉繳保險費。
                            </p>
                        </div>
                        <h2>
                            【契約的終止及保險單借款之限制】<br>第五條
                        </h2>
                        <p>
                            本契約生效後，進入年金給付期間，要保人不得終止契約或申請保險單借款。
                        </p>

                        <h2>
                            【被保險人身故的通知】<br>第六條
                        </h2>
                        <p>
                            被保險人身故後，要保人或受益人應於知悉被保險人發生身故後通知本公司，如仍有未支領之年金餘額，本公司應將其未支領之年金餘額依約定給付予身故受益人或其他應得之人，且不適用第九條第二項之規定。
                        </p>

                        <h2>
                            【失蹤處理】<br>第七條
                        </h2>
                        <p>
                            被保險人在本契約有效期間內失蹤者，除有未支領之保證期間之年金金額外，本公司根據法院宣告死亡判決內所確定死亡時日為準，不再負給付年金責任；但於日後發現被保險人生還時，本公司應依契約約定繼續給付年金，並補足其間未付年金。
                        </p>

                        <h2>
                            【年金金額的給付】<br>第八條
                        </h2>
                        <p>
                            本契約有效期間內，本公司依要保人於投保時所選擇下列方式之一，給付年金金額至保證期間屆滿。 一、年給付型：自第一保單週年日及之後每年之相當日（無相當日者，為該月之末日）給付年金金額。 二、月給付型：自本契約生效日次月起之每月相當日（無相當日者，為該月之末日）給付，其給付金額為年金金額依本契約預定利率換算每月給付之金額。
                            被保險人於保證期間內身故後仍有未支領之年金餘額時，本公司依要保人於身故當時之年金給付型態，給付年金金額予身故受益人或其他應得之人，至保證期間屆滿。 第一項情形，如被保險人於保證期間屆滿後仍生存者，本公司依要保人所選擇下列方式之一，給付年金金額至被保險人身故或被保險人保險年齡達一百十歲之當年度最後一個年金給付日，二者中較早發生者為止，本契約即行終止。
                            一、年給付型：自保證期間屆滿之第一個保單週年日及之後每年之相當日（無相當日者，為該月之末日）給付年金金額之百分之二。 二、月給付型：自保證期間屆滿之第一個保單週年日及之後每月之相當日（無相當日者，為該月之末日）給付，其給付金額為年金金額之百分之二依本契約預定利率換算每月給付之金額。若換算後每月給付之金額低於新臺幣三千元時，本公司將改依年給付型給付之。前項若選擇月給付型，且被保險人於保證期間屆滿後身故者，其身故日至下一個保單週年日前之未給付年金餘額，依本契約之預定利率計算其現值給付之。
                            本條年金金額給付方式若未選擇者，則依年給付型給付，要保人得於本契約有效期間內，以書面通知本公司變更年金金額給付方式，並於申請日起之下一個保單週年日生效。
                        </p>
                        <h2>
                            【年金的申領】<br>第九條
                        </h2>
                        <p>
                            被保險人於生存期間每年第一次支領年金給付時，應提出可資證明被保險人生存之文件。但於保證期間內不在此限。<br> 保證期間年金受益人得申請提前給付，其計算之貼現利率依預定利率按年複利折算。
                            <br> 被保險人身故後仍有未支領之年金餘額時，身故受益人申領年金給付應檢具下列文件：
                            <br> 一、保險單或其謄本。
                            <br> 二、被保險人死亡證明文件及除戶戶籍謄本。
                            <br> 三、受益人的身分證明。
                            <br> 因可歸責於本公司之事由致逾應給付日未給付時，應給付遲延利息年利一分。
                        </p>
                        <h2>
                            【年齡的計算及錯誤的處理】<br>第十條
                        </h2>
                        <p>
                            要保人在申請投保時，應將被保險人出生年月日在要保書填明。被保險人的投保年齡，以足歲計算，但未滿一歲的零數超過六個月者，加算一歲。<br> 被保險人的投保年齡發生錯誤時，依下列規定辦理：
                            <br> 一、真實投保年齡高於本公司保險費率表所載最高年齡者，本契約無效，本公司應將已繳保險費無息退還要保人，如有已給付年金者，受益人應將其無息退還本公司。
                            <br> 二、因投保年齡錯誤，而致本公司短發年金金額者，本公司應計算實付年金金額與應付年金金額的差額，於下次年金給付時按應付年金金額給付，並一次補足過去實付年金金額與應付年金金額的差額。
                            <br> 三、因投保年齡錯誤，而溢發年金金額者，本公司應重新計算實付年金金額與應付年金金額的差額，並於未來年金給付時扣除。
                            <br> 前項第一、二款情形，其錯誤原因歸責於本公司者，應加計利息退還，其利息按本保險單之預定利率與民法第二百零三條法定週年利率兩者取其大之值計算。
                            <br>
                        </p>
                        <h2>
                            【受益人的指定及變更】<br>第十一條
                        </h2>
                        <p>
                            本契約受益人於被保險人生存期間為被保險人本人，本公司不受理其指定或變更。 除前項約定外，要保人得依下列規定指定或變更受益人： 一、於訂立本契約時，得經被保險人同意指定身故受益人，如未指定者，以被保險人之法定繼承人為本契約身故受益人。 二、除聲明放棄處分權者外，於保險事故發生前得經被保險人同意變更身故受益人，如要保人未將前述變更通知本公司者，不得對抗本公司。
                            前項身故受益人的變更，於要保人檢具申請書及被保險人的同意書（要、被保險人為同一人時為申請書或電子申請文件）送達本公司時，本公司即予批註或發給批註書。 第二項之身故受益人同時或先於被保險人本人身故，除要保人已另行指定外，以被保險人之法定繼承人為本契約身故受益人。
                            本契約如未指定身故受益人，而以被保險人之法定繼承人為本契約身故受益人者，其受益順序適用民法第一千一百三十八條規定，其受益比例除契約另有約定外，適用民法第一千一百四十四條規定
                        </p>
                        <h2>
                            【變更住所】<br>第十二條
                        </h2>
                        <p>
                            要保人的住所有變更時，應即以書面或其他約定方式通知本公司。<br> 要保人不為前項通知者，本公司之各項通知，得以本契約所載要保人之最後住所發送之。
                        </p>
                        <h2>
                            【時效】<br>第十三條
                        </h2>
                        <p>
                            由本契約所生的權利，自得為請求之日起，經過兩年不行使而消滅。
                        </p>
                        <h2>
                            【批註】<br>第十四條
                        </h2>
                        <p>
                            本契約內容的變更，或記載事項的增刪，除第十一條規定者外，應經要保人與本公司雙方書面或其他約定方式同意，並由本公司即予批註或發給批註書。
                        </p>
                        <h2>
                            【管轄法院】<br>第十五條
                        </h2>
                        <p>
                            因本契約涉訟者，同意以要保人住所地地方法院為第一審管轄法院，要保人的住所在中華民國境外時，以臺灣台北地方法院為第一審管轄法院。但不得排除消費者保護法第四十七條及民事訴訟法第四百三十六條之九小額訴訟管轄法院之適用。
                        </p>
                        <h2>
                            【不分紅保險單】<br>第十六條
                        </h2>
                        <p>
                            本保險為不分紅保險單，不參加紅利分配，並無紅利給付項目。<br>
                        </p>
                    </div>
                </div>
            </div>


            <!--左視窗-->
            <div class="col-md-6">
                <div class="panel panel-info" id="parameter">
                    <!--heading-->
                    <div class="panel-heading">
                        智能合約
                    </div>
                    <!--body-->
                    <div class="panel-body" id="smart-contract">pragma solidity ^0.4.8

contract Annuity {

    //保險商adress
    address private companyAddress;
    //被保人adress
    address private insuredAddress;
    //時間伺服器address
    address private timerAddress;

    //合約狀態
    uint status;
    //保費(待填入*)
    uint money;
    //部署時間
    uint[3] deployTime;
    //紀錄時間
    uint[3] nowTime;
    //撤銷期限
    uint[3] revocationPeriod;
    //給付年金日
    uint[3] payTime;

    string ver = "1.0.4";

    //合約狀態 0.未被確認 1.契撤期 2.確認並等待給付 3.結束給付 4.被撤銷    uint status;
    string[5] statusStrings;
    //給付間隔 (待填入*)
    uint timeInterval;

    //事件
    event confirmEvent(address from, string inf, uint timestamp);
    event revokeEvent(address from, string inf, uint timestamp);
    event payEvent(address from, string inf, uint timestamp);

    //建構子
    function Annuity(uint y, uint m, uint d) {

        companyAddress = msg.sender;
        insuredAddress = 0xE2320c12C71fb4a91d756d21507B33ee05F2f4C7;
        money = 1000;
        timeInterval = 1;
        status = 0;

        //部署日期
        deployTime = [y,m,d];
        nowTime = [y,m,d];
        //給付年金日 (待填入*)
        payTime = [y+20,m,d];

        statusStrings[0] = "unconfirmed";
        statusStrings[1] = "canBeRevoked";
        statusStrings[2] = "confirmd";
        statusStrings[3] = "end";
        statusStrings[4] = "Revocation";
    }

    function getCompanyAddress() constant returns (address) {
        return companyAddress;
    }
    function getInsurerAddress() constant returns (address) {
        return insuredAddress;
    }
    function getStatus() constant returns (string){
        return statusStrings[status];
    }

    function getDeployTime() constant returns (uint[3]){
        return deployTime;
    }
    function getNowTime() constant returns (uint[3]){
        return nowTime;
    }
    function getRevocationPeriod() constant returns (uint[3]){
        return revocationPeriod;
    }
    function getPayTime() constant returns (uint[3]){
        return payTime;
    }
    function getVersion() constant returns (string){
        return ver;
    }

    //確認合約
    function confirm(uint year, uint month, uint day) {

        //由被保人帳號確認
        //if(msg.sender != insuredAddress) {
        //    throw;
        //}

        //保單尚未被確認
        if(status != 0) {
            confirmEvent(msg.sender , "not yet been confirmed", now);
        }
        else {
            //進入契約撤銷期
            status = 1;

            //設定契約撤銷期限
            revocationPeriod = [year, month, day];

            //通知保險公司傳送契約撤銷確認email
            confirmEvent(msg.sender , "confirm success", now);
        }
    }

    function revoke() {

        //由被保人帳號確認
        //if(msg.sender != insuredAddress) {
        //    throw;
        //}

        //保單不能撤銷
        if(status != 1) {
            //通知保險公司合約不能撤銷
            revokeEvent(msg.sender , "Can not be revoked", now);
        }
        else {
            //撤銷契約
            status = 4;
            //通知保險公司進行契約撤銷流程
            revokeEvent(msg.sender , "revoke the contract", now);
        }
    }

    //被保人死亡
    function endAnnuity() {
        //由保險公司取消
        //if(msg.sender != companyAddress) {
        //    throw;
        //}
        status = 3;
    }

    function time(uint year, uint month, uint day) {

        //紀錄時間
        nowTime = [year, month, day];
        //由第三方時間伺服器設定時間
        //if(msg.sender != timerAddress) {
        //    throw;
        //}

        //撤銷期結束
        if(status == 1) {
            if((year>revocationPeriod[0]) ||
                (year==revocationPeriod[0] && month>revocationPeriod[1]) ||
                (year==revocationPeriod[0] && month==revocationPeriod[1] && day>=revocationPeriod[2])){
                status = 2;
            }
        }
        //開始給付年金
        else if(status == 2) {
            if((year>payTime[0]) ||
                (year==payTime[0] && month>payTime[1]) ||
                (year==payTime[0] && month==payTime[1] && day>=payTime[2])){

                payTime[0] += timeInterval;

                //通知保險公司給付年金
                payEvent(msg.sender , "pay annuity", now);
            }
        }
    }

    function version() constant returns(string) {
        return ver;
    }

    //摧毀合約
    function destroy() {
         if (msg.sender == companyAddress) {
             suicide(companyAddress);
        }
    }

}
                    </div>
                </div>
            </div>

            <div class="col-sm-2">
                <button id="deploy" class="btn btn-success btn-lg" type="submit">部署</button>
            </div>
            <div class="col-sm-10">
                <div class="progress">
                    <div id="progress" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                    </div>
                </div>
            <div class="col-sm-2">
        </div>
    </div>
</section>

{{#section 'script'}}
<script src="js/template.js"></script>
{{/section}}